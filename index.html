<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.5.0/socket.io.min.js"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        const socket = io('https://ros-nzq9.onrender.com'); // Render URL ကို ပြန်သတ်မှတ်ပါ

        const menuData = {
            'Appetizers': Array(10).fill().map((_, i) => ({
                id: `app-${i}`,
                name: `အစားအစာ ${i + 1}`,
                description: 'အစားအစာအစပို့တစ်ခုကို စားဖို့ အဆင့်မြှင့်ပေးပါတယ်။',
                price: 5.99 + i,
                image: `https://images.unsplash.com/photo-1514326640560-7d063ef2aed5?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Main Course': Array(10).fill().map((_, i) => ({
                id: `main-${i}`,
                name: `အဓိကဟင်း ${i + 1}`,
                description: 'သင့်ဗိုက်ကို ကျန်းမာစေတဲ့ အဓိကဟင်းတစ်ခု။',
                price: 12.99 + i,
                image: `https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Desserts': Array(10).fill().map((_, i) => ({
                id: `dessert-${i}`,
                name: `အချိုပွဲ ${i + 1}`,
                description: 'သင့်နေ့ရက်ကို အဆုံးသတ်ဖို့ ချမ်းသာတဲ့ အစားအစာ။',
                price: 4.99 + i,
                image: `https://images.unsplash.com/photo-1563729784474-d77dbb933a3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Drinks': Array(10).fill().map((_, i) => ({
                id: `drink-${i}`,
                name: `သောက်စရာ ${i + 1}`,
                description: 'သင့်ဟင်းကို လိုက်ဖက်တဲ့ သောက်စရာတစ်ခု။',
                price: 2.99 + i,
                image: `https://images.unsplash.com/photo-1513553404607-988bf2703777?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Salads': Array(10).fill().map((_, i) => ({
                id: `salad-${i}`,
                name: `သုပ် ${i + 1}`,
                description: 'လှပပြီး ကျန်းမာရေးနဲ့ ကိုက်ညီတဲ့ သုပ်ရွက်တစ်ခု။',
                price: 6.99 + i,
                image: `https://images.unsplash.com/photo-1512621776951-a57141f2eefd?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Soups': Array(10).fill().map((_, i) => ({
                id: `soup-${i}`,
                name: `ဟင်းချို ${i + 1}`,
                description: 'အပူပေးပြီး သက်သာစေတဲ့ ဟင်းချိုတစ်ခု။',
                price: 4.99 + i,
                image: `https://images.unsplash.com/photo-1547592166-23ac45744c94?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Sides': Array(10).fill().map((_, i) => ({
                id: `side-${i}`,
                name: `ဘေးထွက် ${i + 1}`,
                description: 'သင့်ဟင်းနဲ့ လိုက်ဖက်တဲ့ ဘေးထွက်အစားအစာ။',
                price: 3.99 + i,
                image: `https://images.unsplash.com/photo-1626700051175-6818013e1d4f?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            })),
            'Specials': Array(10).fill().map((_, i) => ({
                id: `special-${i}`,
                name: `အထူး ${i + 1}`,
                description: 'ချက်ပြုတ်သူရဲ့ ထူးခြားတဲ့ ဟင်းတစ်ခု။',
                price: 15.99 + i,
                image: `https://images.unsplash.com/photo-1551218807-89649560f1e0?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80&${i}`
            }))
        };

        const LoginPopup = ({ onLogin }) => {
            const [name, setName] = useState('');
            const [phone, setPhone] = useState('');

            const handleLogin = () => {
                if (name && phone) {
                    localStorage.setItem('customerName', name);
                    localStorage.setItem('customerPhone', phone);
                    onLogin({ name, phone });
                } else {
                    alert('ကျေးဇူးပြု၍ နာမည်နဲ့ ဖုန်းနံပါတ် ထည့်ပါ။');
                }
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-lg p-6 max-w-md w-full">
                        <h2 className="text-xl font-bold mb-4">Login</h2>
                        <div className="mb-4">
                            <label className="block mb-2 font-semibold">နာမည်</label>
                            <input
                                type="text"
                                value={name}
                                onChange={(e) => setName(e.target.value)}
                                className="border p-2 rounded w-full"
                                placeholder="သင့်နာမည်ထည့်ပါ"
                            />
                        </div>
                        <div className="mb-4">
                            <label className="block mb-2 font-semibold">ဖုန်းနံပါတ်</label>
                            <input
                                type="tel"
                                value={phone}
                                onChange={(e) => setPhone(e.target.value)}
                                className="border p-2 rounded w-full"
                                placeholder="သင့်ဖုန်းနံပါတ်ထည့်ပါ"
                            />
                        </div>
                        <button onClick={handleLogin} className="bg-blue-500 text-white px-4 py-2 rounded w-full">Login</button>
                    </div>
                </div>
            );
        };

        const MenuItem = ({ item, onClick }) => (
            <div className="bg-white rounded-lg shadow-md overflow-hidden cursor-pointer" onClick={() => onClick(item)}>
                <img src={item.image} alt={item.name} className="w-full h-40 object-cover" />
                <div className="p-4">
                    <h3 className="font-semibold">{item.name}</h3>
                    <p className="text-sm text-gray-600 truncate">{item.description}</p>
                    <p className="font-bold mt-2">${item.price.toFixed(2)}</p>
                </div>
            </div>
        );

        const ItemPopup = ({ item, onClose, onAdd }) => (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div className="bg-white rounded-lg p-6 max-w-md w-full">
                    <h2 className="text-xl font-bold mb-4">{item.name}</h2>
                    <img src={item.image} alt={item.name} className="w-full h-48 object-cover rounded mb-4" />
                    <p className="text-gray-600 mb-4">{item.description}</p>
                    <p className="font-bold mb-4">${item.price.toFixed(2)}</p>
                    <div className="flex justify-between">
                        <button onClick={onAdd} className="bg-green-500 text-white px-4 py-2 rounded">ပေါင်းထည့်ပါ</button>
                        <button onClick={onClose} className="bg-red-500 text-white px-4 py-2 rounded">မလုပ်တော့ပါ</button>
                    </div>
                </div>
            </div>
        );

        const MessagePopup = ({ message, onClose }) => (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                <div className="bg-white rounded-lg p-6 max-w-md w-full text-center">
                    <p className="mb-4">{message}</p>
                    <button onClick={onClose} className="bg-blue-500 text-white px-4 py-2 rounded">သိပါတယ်</button>
                </div>
            </div>
        );

        const CartPopup = ({ cart, onClose, onUpdateQuantity, onRemove, onConfirm, customer, language }) => {
            const [orderType, setOrderType] = useState('Dine In');
            const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);

            return (
                <div className="fixed inset-0 bg-white z-50 overflow-y-auto">
                    <div className="p-4">
                        <div className="flex justify-between items-center mb-4">
                            <div>
                                <img src="https://images.unsplash.com/photo-1589301771357-2b157f5d29f2?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="Logo" className="h-12" />
                                <h2 className="text-xl font-bold">{language === 'mm' ? 'ဈေးခြင်း' : 'Cart'}</h2>
                            </div>
                            <button onClick={onClose} className="text-red-500">{language === 'mm' ? 'ပိတ်ရန်' : 'Close'}</button>
                        </div>
                        {cart.length === 0 ? (
                            <p>{language === 'mm' ? 'ဈေးခြင်းထဲတွင် ဘာမှမရှိပါ။' : 'Your cart is empty.'}</p>
                        ) : (
                            <div>
                                {cart.map((item, index) => (
                                    <div key={index} className="flex justify-between items-center mb-4 bg-gray-100 p-4 rounded">
                                        <div>
                                            <h3 className="font-semibold">{item.name}</h3>
                                            <p>${item.price.toFixed(2)}</p>
                                            <div className="flex items-center mt-2">
                                                <button onClick={() => onUpdateQuantity(index, item.quantity - 1)} className="bg-gray-300 px-2 py-1 rounded">-</button>
                                                <span className="mx-2">{item.quantity}</span>
                                                <button onClick={() => onUpdateQuantity(index, item.quantity + 1)} className="bg-gray-300 px-2 py-1 rounded">+</button>
                                            </div>
                                        </div>
                                        <button onClick={() => onRemove(index)} className="text-red-500">{language === 'mm' ? 'ဖယ်ရှားရန်' : 'Remove'}</button>
                                    </div>
                                ))}
                                <div className="mt-4">
                                    <label className="block mb-2 font-semibold">{language === 'mm' ? 'အော်ဒါအမျိုးအစား' : 'Order Type'}</label>
                                    <select value={orderType} onChange={(e) => setOrderType(e.target.value)} className="border p-2 rounded w-full">
                                        <option value="Dine In">{language === 'mm' ? 'စားသုံးရန်' : 'Dine In'}</option>
                                        <option value="Takeaway">{language === 'mm' ? 'ယူသွားရန်' : 'Takeaway'}</option>
                                        <option value="Delivery">{language === 'mm' ? 'ပို့ဆောင်ရန်' : 'Delivery'}</option>
                                    </select>
                                </div>
                                <p className="font-bold mt-4">{language === 'mm' ? 'စုစုပေါင်း' : 'Total'}: ${total.toFixed(2)}</p>
                                <button onClick={() => onConfirm(orderType, total)} className="bg-blue-500 text-white px-4 py-2 rounded w-full mt-4">{language === 'mm' ? 'အတည်ပြုရန်' : 'Confirm Order'}</button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const App = () => {
            const [language, setLanguage] = useState('mm');
            const [category, setCategory] = useState('Appetizers');
            const [selectedItem, setSelectedItem] = useState(null);
            const [cart, setCart] = useState([]);
            const [customer, setCustomer] = useState(null);
            const [message, setMessage] = useState('');
            const [showMyProfile, setShowMyProfile] = useState(false);
            const [history, setHistory] = useState([]);

            useEffect(() => {
                const savedName = localStorage.getItem('customerName');
                const savedPhone = localStorage.getItem('customerPhone');
                if (savedName && savedPhone) {
                    setCustomer({ name: savedName, phone: savedPhone });
                }

                socket.on('orderUpdate', (updatedOrder) => {
                    setHistory(prev => prev.map(order => order.id === updatedOrder.id ? updatedOrder : order));
                });

                return () => {
                    socket.off('orderUpdate');
                };
            }, []);

            const handleAddToCart = (item) => {
                setCart(prev => {
                    const existingItem = prev.find(i => i.id === item.id);
                    if (existingItem) {
                        return prev.map(i => i.id === item.id ? { ...i, quantity: i.quantity + 1 } : i);
                    }
                    return [...prev, { ...item, quantity: 1 }];
                });
                setSelectedItem(null);
                setMessage(`${item.name} ${language === 'mm' ? 'ကို ဈေးခြင်းထဲ ထည့်လိုက်ပါပြီ။' : 'has been added to your cart.'}`);
            };

            const handleUpdateQuantity = (index, newQuantity) => {
                if (newQuantity <= 0) {
                    setCart(prev => prev.filter((_, i) => i !== index));
                } else {
                    setCart(prev => prev.map((item, i) => i === index ? { ...item, quantity: newQuantity } : item));
                }
            };

            const handleRemoveFromCart = (index) => {
                setCart(prev => prev.filter((_, i) => i !== index));
            };

            const handleConfirmOrder = (orderType, total) => {
                if (!customer) {
                    alert(language === 'mm' ? 'ကျေးဇူးပြု၍ အကောင့်ဝင်ပါ။' : 'Please login first.');
                    return;
                }

                const orderDetails = cart.map(item => ({
                    name: item.name,
                    quantity: item.quantity,
                    price: item.price
                }));

                const order = {
                    id: Date.now().toString(),
                    customerId: customer.phone.slice(-4),
                    customerName: customer.name,
                    customerPhone: customer.phone,
                    orderDetails,
                    orderType,
                    total,
                    status: 'Pending',
                    timestamp: new Date().toISOString()
                };

                socket.emit('newOrder', order);
                setHistory(prev => [...prev, order]);
                setCart([]);
                setMessage(language === 'mm' ? 'အော်ဒါ အတည်ပြုပြီးပါပြီ။ ကျေးဇူးတင်ပါတယ်။' : 'Order confirmed! Thank you.');
            };

            const handleLogin = (user) => {
                setCustomer(user);
            };

            const handleLogout = () => {
                localStorage.removeItem('customerName');
                localStorage.removeItem('customerPhone');
                setCustomer(null);
                setShowMyProfile(false);
                setMessage(language === 'mm' ? 'အကောင့်မှ ထွက်လိုက်ပါပြီ။' : 'Logged out successfully.');
            };

            return (
                <div className="min-h-screen bg-gray-100">
                    {!customer && <LoginPopup onLogin={handleLogin} />}
                    {selectedItem && <ItemPopup item={selectedItem} onClose={() => setSelectedItem(null)} onAdd={handleAddToCart} />}
                    {message && <MessagePopup message={message} onClose={() => setMessage('')} />}
                    <div className="container mx-auto p-4">
                        <div className="flex justify-between items-center mb-4">
                            <div className="flex items-center">
                                <img src="https://images.unsplash.com/photo-1589301771357-2b157f5d29f2?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="Logo" className="h-12 mr-4" />
                                <h1 className="text-2xl font-bold">{language === 'mm' ? 'မီနူး' : 'Menu'}</h1>
                            </div>
                            <div className="flex items-center space-x-4">
                                <select
                                    value={language}
                                    onChange={(e) => setLanguage(e.target.value)}
                                    className="border p-2 rounded"
                                >
                                    <option value="mm">မြန်မာ</option>
                                    <option value="en">English</option>
                                </select>
                                {customer && (
                                    <button
                                        onClick={() => setShowMyProfile(true)}
                                        className="bg-blue-500 text-white px-4 py-2 rounded"
                                    >
                                        {language === 'mm' ? 'ကိုယ်ရေးအကောင့်' : 'My Profile'}
                                    </button>
                                )}
                                <button
                                    onClick={() => (cart.length > 0 ? setShowMyProfile(true) : setMessage(language === 'mm' ? 'ဈေးခြင်းထဲမှာ ဘာမှမရှိပါ။' : 'Cart is empty.'))}
                                    className="bg-green-500 text-white px-4 py-2 rounded"
                                >
                                    {language === 'mm' ? `ဈေးခြင်း (${cart.length})` : `Cart (${cart.length})`}
                                </button>
                            </div>
                        </div>
                        <div className="flex flex-wrap gap-2 mb-4">
                            {Object.keys(menuData).map(cat => (
                                <button
                                    key={cat}
                                    onClick={() => setCategory(cat)}
                                    className={`px-4 py-2 rounded ${category === cat ? 'bg-blue-500 text-white' : 'bg-gray-200'}`}
                                >
                                    {cat}
                                </button>
                            ))}
                        </div>
                        <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                            {menuData[category].map(item => (
                                <MenuItem key={item.id} item={item} onClick={setSelectedItem} />
                            ))}
                        </div>
                    </div>
                    {customer && cart.length > 0 && (
                        <CartPopup
                            cart={cart}
                            onClose={() => setShowMyProfile(false)}
                            onUpdateQuantity={handleUpdateQuantity}
                            onRemove={handleRemoveFromCart}
                            onConfirm={handleConfirmOrder}
                            customer={customer}
                            language={language}
                        />
                    )}
                    {customer && showMyProfile && (
                        <div className="fixed inset-0 bg-white z-50 overflow-y-auto">
                            <div className="p-4">
                                <div className="flex justify-between items-center mb-4">
                                    <div>
                                        <img src="https://images.unsplash.com/photo-1589301771357-2b157f5d29f2?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" alt="Logo" className="h-12" />
                                        <h2 className="text-xl font-bold">{language === 'mm' ? 'ကိုယ်ရေးအကောင့်' : 'My Profile'}</h2>
                                    </div>
                                    <button onClick={() => setShowMyProfile(false)} className="text-red-500">{language === 'mm' ? 'ပိတ်ရန်' : 'Exit'}</button>
                                </div>
                                <div className="mb-6 bg-gray-100 p-4 rounded">
                                    <h3 className="text-lg font-semibold mb-2">{language === 'mm' ? 'ဖောက်သည်အချက်အလက်' : 'Customer Information'}</h3>
                                    <p><strong>{language === 'mm' ? 'ဖောက်သည် ID' : 'Customer ID'}:</strong> {customer.phone.slice(-4)}</p>
                                    <p><strong>{language === 'mm' ? 'နာမည်' : 'Name'}:</strong> {customer.name}</p>
                                    <p><strong>{language === 'mm' ? 'ဖုန်းနံပါတ်' : 'Phone'}:</strong> {customer.phone}</p>
                                    <button onClick={handleLogout} className="bg-red-500 text-white px-4 py-2 rounded mt-4">{language === 'mm' ? 'အကောင့်မှ ထွက်ရန်' : 'Log Out'}</button>
                                </div>
                                <h3 className="text-lg font-semibold mb-4">{language === 'mm' ? 'မှာယူမှုများ' : 'Order History'}</h3>
                                {history.map((order, index) => (
                                    <div key={index} className="mb-4 bg-gray-100 p-4 rounded">
                                        <p><strong>{language === 'mm' ? `မှာယူမှု #${index + 1}` : `Order #${index + 1}`}</strong></p>
                                        <p>{language === 'mm' ? 'အမျိုးအစား' : 'Type'}: {order.orderType}</p>
                                        <p>{language === 'mm' ? 'စုစုပေါင်း' : 'Total'}: ${order.total.toFixed(2)}</p>
                                        <p>{language === 'mm' ? 'အချိန်' : 'Time'}: {new Date(order.timestamp).toLocaleString()}</p>
                                        <p className="font-bold">{language === 'mm' ? 'အခြေအနေ' : 'Status'}: {order.status === 'In Process' ? (language === 'mm' ? 'လုပ်ဆောင်နေပါပြီ' : 'In Process') : order.status === 'Delivered' ? (language === 'mm' ? 'ပို့ဆောင်ပြီးပါပြီ' : 'Delivered') : order.status === 'Cancelled' ? (language === 'mm' ? 'ပယ်ဖျက်လိုက်ပါပြီ' : 'Cancelled') : (language === 'mm' ? 'စောင့်ဆိုင်းနေသည်' : 'Pending')}</p>
                                        {order.status === 'In Process' && (
                                            <p className="text-green-600">{language === 'mm' ? 'သင့်အော်ဒါအား လုပ်ဆောင်နေပါပြီ။ အရသာရှိစွာနဲ့ မြန်ဆန်ဖို့ ကြိုးစားနေပါတယ်' : 'We are processing your order. Preparing it deliciously and quickly!'}</p>
                                        )}
                                        <div className="mt-2">
                                            <strong>{language === 'mm' ? 'မှာယူထားသည်များ' : 'Items'}:</strong>
                                            <ul className="list-disc pl-5">
                                                {order.orderDetails.map((item, i) => (
                                                    <li key={i}>{item.name} x{item.quantity} - ${(item.price * item.quantity).toFixed(2)}</li>
                                                ))}
                                            </ul>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>